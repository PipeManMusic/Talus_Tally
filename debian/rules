#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	cd frontend && npm run build

override_dh_auto_install:
	mkdir -p debian/talus-tally/usr/bin
	mkdir -p debian/talus-tally/opt/talus-tally
	mkdir -p debian/talus-tally/opt/talus_tally
	mkdir -p debian/talus-tally/usr/share/applications
	mkdir -p debian/talus-tally/usr/share/icons/hicolor/256x256/apps
	
	# Copy the binary (from the Tauri build output)
	cp -r frontend/src-tauri/target/release/app debian/talus-tally/usr/bin/talus-tally || true
	
	# Copy backend and assets
	cp -r backend debian/talus-tally/opt/talus-tally/
	cp -r assets debian/talus-tally/opt/talus_tally/
	cp -r data debian/talus-tally/opt/talus_tally/
	ln -s ../talus_tally/assets debian/talus-tally/opt/talus-tally/assets
	ln -s ../talus_tally/data debian/talus-tally/opt/talus-tally/data
	cp -r venv debian/talus-tally/opt/talus-tally/ || true
	cp requirements.txt debian/talus-tally/opt/talus-tally/
	
	# Copy desktop entry
	cp debian/talus-tally.desktop debian/talus-tally/usr/share/applications/
	
	# Copy icon for launcher and taskbar
	install -m 644 frontend/src-tauri/icons/icon.png debian/talus-tally/usr/share/icons/hicolor/256x256/apps/talus-tally.png
	install -m 644 frontend/src-tauri/icons/icon.png debian/talus-tally/usr/share/pixmaps/talus-tally.png

	# Copy icon install script for postinst
	mkdir -p debian/talus-tally/opt/talus_tally/scripts
	cp scripts/install_talus_tally_icon.sh debian/talus-tally/opt/talus_tally/scripts/

	# Copy TalusTallyIcon.png for icon install script
	install -m 644 assets/icons/TalusTallyIcon.png debian/talus-tally/opt/talus_tally/frontend/src-tauri/icons/TalusTallyIcon.png
